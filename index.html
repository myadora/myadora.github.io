<!DOCTYPE html>
<html>
  <head>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Kanit&display=swap"
      rel="stylesheet"
    />

    <style>
      body {
        font-family: "Kanit", sans-serif;
      }

      table {
        border-collapse: collapse;
        border-spacing: 0;
        width: 100%;
        border: 1px solid #ddd;
        font-size: 10px;
      }

      th {
        text-align: center;
        vertical-align: middle;
      }

      a {
        text-align: center;
        vertical-align: middle;
      }

      td {
        text-align: center;
        padding: 8px;
      }

      tr:nth-child(even) {
        background-color: #f2f2f2;
      }
    </style>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous"
    />
    <script
      src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
      integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
      integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
      crossorigin="anonymous"
    ></script>
  </head>

  <body>
    <div class="container">
      <div class="form-group mt-4">
        <label for="start">Start :</label>
        <input
          type="datetime-local"
          class="form-control btn-sm"
          id="start"
          name="start"
        />
      </div>
      <div class="form-group">
        <label for="start">End :</label>
        <input
          type="datetime-local"
          class="form-control btn-sm"
          id="end"
          name="end"
        />
      </div>
      <input
        type="button"
        value="เริ่มใหม่หมด"
        class="btn btn-danger btn-sm"
        onclick="location.reload()"
      />
      <input
        type="button"
        value="เพิ่มเวลา"
        class="btn btn-success btn-sm"
        onclick="Add()"
      />

      <hr />

      <table id="data" class="table table-striped table-bordered table-sm">
        <tr>
          <th>Start</th>
          <th>End</th>
        </tr>
        <tr></tr>
      </table>

      <hr />
      <div style="overflow-x: auto">
        <!-- <table id="data" class="table table-bordered"> -->
        <table
          id="hz"
          class="table table-striped table-bordered table-sm"
          cellspacing="0"
          width="100%"
        >
          <tr>
            <th>จำนวนชั่วโมงงาน</th>
            <th colspan="3" style="text-align: center; vertical-align: middle">
              11 ชั่วโมง
            </th>
          </tr>

          <tr>
            <th style="text-align: center; vertical-align: middle">ช่วงเวลา</th>
            <th style="text-align: center; vertical-align: middle">
              จำนวน(ชั่วโมง)
            </th>
            <th style="text-align: center; vertical-align: middle">เรทคำนวณ</th>
            <th style="text-align: center; vertical-align: middle">
              ผลลัพธ์(ชั่วโมง)
            </th>
          </tr>
          <tr>
            <th style="text-align: center; vertical-align: middle">16-20</th>
            <th style="text-align: center; vertical-align: middle">
              <div id="totalHour1620"></div>
            </th>
            <th style="text-align: center; vertical-align: middle">1</th>
            <th style="text-align: center; vertical-align: middle">
              <div id="calTotalHour1620"></div>
            </th>
          </tr>
          <tr>
            <th style="text-align: center; vertical-align: middle">20-24</th>
            <th style="text-align: center; vertical-align: middle">
              <div id="totalHour2024"></div>
            </th>
            <th style="text-align: center; vertical-align: middle">1.5</th>
            <th style="text-align: center; vertical-align: middle">
              <div id="calTotalHour2024"></div>
            </th>
          </tr>
          <tr>
            <th style="text-align: center; vertical-align: middle">00-03</th>
            <th style="text-align: center; vertical-align: middle">
              <div id="totalHour0308"></div>
            </th>
            <th style="text-align: center; vertical-align: middle">2.5</th>
            <th style="text-align: center; vertical-align: middle">
              <div id="calTotalHour0308"></div>
            </th>
          </tr>
          <tr>
            <th style="text-align: center; vertical-align: middle">03-08</th>
            <th style="text-align: center; vertical-align: middle">
              <div id="totalHour2403"></div>
            </th>
            <th style="text-align: center; vertical-align: middle">2.5</th>
            <th style="text-align: center; vertical-align: middle">
              <div id="calTotalHour2403"></div>
            </th>
          </tr>
          <tr>
            <th style="text-align: center; vertical-align: middle">
              รวมชั่วโมงงาน
            </th>
            <th style="text-align: center; vertical-align: middle">
              <div id="totalHour"></div>
            </th>
            <th style="text-align: center; vertical-align: middle">
              รวมชั่วโมง(ใหม่)
            </th>
            <th style="text-align: center; vertical-align: middle">
              <div id="calTotalHour"></div>
            </th>
          </tr>
          <tr>
            <th style="text-align: center; vertical-align: middle">แปลผล</th>
            <th colspan="3" style="text-align: center; vertical-align: middle">
              <div id="textResult"></div>
            </th>
          </tr>
          <tr>
            <th style="text-align: center; vertical-align: middle">เวลา Off</th>
            <th colspan="3" style="text-align: center; vertical-align: middle">
              <div id="offTime8"></div>
            </th>
          </tr>
        </table>
      </div>
    </div>
  </body>
  <script
    type="text/JavaScript"
    src="https://MomentJS.com/downloads/moment.js"
  ></script>
  <script>
    let totalHour = 0;
    let totalHour1620 = 0;
    let totalHour2024 = 0;
    let totalHour2403 = 0;
    let totalHour0308 = 0;
    document.getElementById("offTime8").innerHTML = "";
    function Add() {
      let start = document.getElementById("start").value;
      let end = document.getElementById("end").value;

      let startTime = moment(start).format("YYYY-MM-DD HH:mm");
      let endTime = moment(end).format("YYYY-MM-DD HH:mm");

      let totalMinute1620 = 0;
      let totalMinute2024 = 0;
      let totalMinute2403 = 0;
      let totalMinute0308 = 0;
      if (start && end) {
        //START MOVE
        let table = document.getElementById("data");
        let row = table.insertRow(-1);
        let cell1 = row.insertCell(0);
        let cell2 = row.insertCell(1);
        cell1.innerHTML = startTime;
        cell2.innerHTML = endTime;
        //END MOVE
        let duration = moment.duration(moment(end).diff(moment(start)));
        let asMinutes = duration.asMinutes();
        console.log("asMinutes", asMinutes);
        let countStart = moment(start)
          .add(0, "minutes")
          .format("YYYY-MM-DD HH:mm");
        let i = Math.abs(asMinutes);
        if (i > 100000) {
          i = 0;
        }
        while (i != 0) {
          if (
            countStart >= moment(countStart).format("YYYY-MM-DD 16:00") &&
            countStart < moment(countStart).format("YYYY-MM-DD 20:00")
          ) {
            totalMinute1620 += 1;
          } else if (
            countStart >= moment(countStart).format("YYYY-MM-DD 20:00") &&
            countStart < moment(countStart).format("YYYY-MM-DD 24:00")
          ) {
            totalMinute2024 += 1;
          } else if (
            countStart >= moment(countStart).format("YYYY-MM-DD 00:00") &&
            countStart < moment(countStart).format("YYYY-MM-DD 03:00")
          ) {
            totalMinute2403 += 1;
          } else if (
            countStart >= moment(countStart).format("YYYY-MM-DD 03:00") &&
            countStart < moment(countStart).format("YYYY-MM-DD 08:00")
          ) {
            totalMinute0308 += 1;
          }
          countStart = moment(countStart)
            .add(1, "minutes")
            .format("YYYY-MM-DD HH:mm");
          i--;
        }
        console.log("totalMinute1620", totalMinute1620);
        console.log("totalMinute2024", totalMinute2024);
        console.log("totalMinute2403", totalMinute2403);
        console.log("totalMinute0308", totalMinute0308);
        totalHour1620 += Number((totalMinute1620 / 60).toFixed(4));
        totalHour2024 += Number((totalMinute2024 / 60).toFixed(4));
        totalHour2403 += Number((totalMinute2403 / 60).toFixed(4));
        totalHour0308 += Number((totalMinute0308 / 60).toFixed(4));
        totalHour =
          totalHour1620 + totalHour2024 + totalHour2403 + totalHour0308;
        console.log("totalHour1620", totalHour1620);
        console.log("totalHour2024", totalHour2024);
        console.log("totalHour2403", totalHour2403);
        console.log("totalHour0308", totalHour0308);
        console.log("totalHour", totalHour);
        document.getElementById("totalHour1620").innerHTML = "";
        document.getElementById("totalHour2024").innerHTML = "";
        document.getElementById("totalHour2403").innerHTML = "";
        document.getElementById("totalHour0308").innerHTML = "";
        document.getElementById("totalHour").innerHTML = "";
        document.getElementById("totalHour1620").innerHTML = totalHour1620;
        document.getElementById("totalHour2024").innerHTML = totalHour2024;
        document.getElementById("totalHour2403").innerHTML = totalHour2403;
        document.getElementById("totalHour0308").innerHTML = totalHour0308;
        document.getElementById("totalHour").innerHTML = totalHour;

        document.getElementById("calTotalHour1620").innerHTML = (
          totalHour1620 * 1
        ).toFixed(4);
        document.getElementById("calTotalHour2024").innerHTML = (
          totalHour2024 * 1.5
        ).toFixed(4);
        document.getElementById("calTotalHour2403").innerHTML = (
          totalHour2403 * 2.5
        ).toFixed(4);
        document.getElementById("calTotalHour0308").innerHTML = (
          totalHour0308 * 2.5
        ).toFixed(4);
        calTotalHour =
          totalHour1620 * 1 +
          totalHour2024 * 1.5 +
          totalHour2403 * 2.5 +
          totalHour0308 * 2.5;
        document.getElementById("calTotalHour").innerHTML =
          calTotalHour.toFixed(4);

        if (calTotalHour - 11 >= 1) {
          document.getElementById("textResult").innerHTML = "OFF";
          document
            .getElementById("textResult")
            .setAttribute("style", "color:green");
          document.getElementById("offTime8").innerHTML = "OFF";
          document
            .getElementById("offTime8")
            .setAttribute("style", "color:green");
        } else {
          let workHourCon = (11 - calTotalHour).toFixed(2);
          document.getElementById(
            "textResult"
          ).innerHTML = `ชดเชย ${workHourCon} ชั่วโมง`;
          let checkTimeOff = moment("08:00", "HH:mm")
            .add(workHourCon, "hour")
            .format("HH:mm");
          document.getElementById("offTime8").innerHTML = checkTimeOff;
          if (checkTimeOff >= "16:00") {
            document.getElementById("offTime8").innerHTML = "16:00";
          }
          document
            .getElementById("textResult")
            .setAttribute("style", "color:red");
        }
      } else {
        return alert("กรอกเวลาให้ครบ");
      }
      document.getElementById("start").value = "";
      document.getElementById("end").value = "";
    }
  </script>
</html>
